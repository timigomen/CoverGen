<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoverGen</title>
    <style>
        body {
            font-family: 'PingFang';
            src: url('./PingFang.ttc') format('truetype');
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;

        }

        h1 {
            font-size: 2.5em;
            color: #333;
            margin-top: 20px;
        }

        input[type="file"],
input[type="text"],
button {
    margin: 10px;
    padding: 8px 12px;
    border: none;
    background-color: rgba(0, 123, 255, 0.8); /* 使用rgba设置半透明背景色 */
    color: #fff;
    font-size: 1em;
    cursor: pointer;
    border-radius: 10px; /* 添加圆角 */
    background-color: rgba(0, 123, 255, 0.5); /* 设置半透明背景色实现毛玻璃效果 */
    backdrop-filter: blur(10px); /* 添加模糊效果，实现毛玻璃效果 */
}


        input[type="file"] {
            display: block;
        }

        button:hover {
            background-color: #0056b3;
        }

        #output {
            margin-top: 20px;
        }

        canvas {
            display: none;
        }
        input::placeholder {
    color: white;
}
    </style>
</head>

<body>
    <h1>CoverGen</h1>
    <input type="file" id="bgImageInput" accept="image/*"><br>
    <input type="file" id="squareImageInput" accept="image/*"><br>
    <input type="text" id="textInput" placeholder="输入标题"><br>
    <button onclick="generateImage()">生成</button>
    <button onclick="savePreset()">保存标题</button>
    <button onclick="loadPreset()">历史</button>
    <div id="output"></div>

    <script>
        function generateImage() {
            const bgImage = document.getElementById('bgImageInput').files[0];
            const squareImage = document.getElementById('squareImageInput').files[0];
            const text = document.getElementById('textInput').value;

            if (!bgImage || !squareImage || text === '') {
                alert('请选择背景图像、方形图像，然后输入文本。');
                return;
            }

            const readerBg = new FileReader();
            readerBg.onload = function (e) {
                const bgImageUrl = e.target.result;

                const readerSquare = new FileReader();
                readerSquare.onload = function (e) {
                    const squareImageUrl = e.target.result;

                    const canvas = document.createElement('canvas');
                    document.body.appendChild(canvas); // 添加到文档中

                    const ctx = canvas.getContext('2d');

                    const img = new Image();
                    img.onload = function () {
                        canvas.width = 1000;
                        canvas.height = 500;

                        ctx.save();
                        ctx.beginPath();
                        ctx.moveTo(18, 0);
                        ctx.lineTo(canvas.width - 18, 0);
                        ctx.quadraticCurveTo(canvas.width, 0, canvas.width, 18);
                        ctx.lineTo(canvas.width, canvas.height - 18);
                        ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - 18, canvas.height);
                        ctx.lineTo(18, canvas.height);
                        ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - 18);
                        ctx.lineTo(0, 18);
                        ctx.quadraticCurveTo(0, 0, 18, 0);
                        ctx.closePath();
                        ctx.clip();

                        ctx.filter = 'blur(5px)';
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                        const squareImg = new Image();
                        squareImg.onload = function () {
                            const size = Math.min(canvas.width, canvas.height) / 2;
                            const x = (canvas.width - size) / 2;
                            const y = (canvas.height - size) / 2;

                            ctx.globalAlpha = 1.0;
                            ctx.filter = 'none';
                            ctx.font = 'bold 150px PingFang';
                            ctx.fillStyle = 'white';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(text, canvas.width / 2, canvas.height / 2);

                            ctx.beginPath();
                            ctx.arc(x + size / 2, y + size / 2, size / 2, 0, 2 * Math.PI);
                            ctx.clip();

                            ctx.globalAlpha = 1.0;
                            ctx.drawImage(squareImg, x, y, size, size);

                            ctx.clip();

                            ctx.globalAlpha = 1.0;

                            const output = document.getElementById('output');
                            output.innerHTML = '<img src="' + canvas.toDataURL() + '" style="border-radius: 18px;" alt="Custom Image"><br><button onclick="saveWebp()">Save</button>';
                        };
                        squareImg.src = squareImageUrl;
                    };
                    img.src = bgImageUrl;
                };
                readerSquare.readAsDataURL(squareImage);
            };
            readerBg.readAsDataURL(bgImage);
        }

        function saveWebp() {
            var canvas = document.querySelector('canvas'); // 获取canvas元素
            var image = canvas.toDataURL("image/webp");
            var link = document.createElement('a');
            link.download = 'canvasImage.webp';
            link.href = image;
            link.click();
        }

        function savePreset() {
            const textInput = document.getElementById('textInput');
            localStorage.setItem('textInput', textInput.value);
        }

        function loadPreset() {
            const textInput = document.getElementById('textInput');
            textInput.value = localStorage.getItem('textInput') || '';
        }

    </script>
</body>

</html>